<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Audit des Flux Réseaux - ISO 27001</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --success: #48bb78;
    --danger: #f56565;
    --warning: #ed8936;
    --gray: #718096;
    --bg: #ffffff;
    --text: #2d3748;
    --border: #e2e8f0;
}
body.dark {
    --bg: #1a202c;
    --text: #e2e8f0;
    --border: #4a5568;
}
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s, color 0.3s;
}
header {
    background: var(--primary);
    color: white;
    padding: 0.8rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}
header h1 {
    font-size: 1.1rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.toolbar {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
}
.btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0.4rem 0.7rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.btn:hover { background: var(--primary-dark); }
.btn-secondary { background: var(--gray); }
.btn-danger { background: var(--danger); }
.btn-success { background: var(--success); }
.search-box {
    padding: 0.3rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.8rem;
}
main {
    padding: 1rem;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
}
th, td {
    padding: 0.5rem;
    border: 1px solid var(--border);
    text-align: left;
}
th {
    background: var(--primary);
    color: white;
    cursor: pointer;
}
tr:nth-child(even) {
    background: rgba(0,0,0,0.02);
}
.risk-low { background: #e6ffed; }
.risk-medium { background: #fff8e1; }
.risk-high { background: #ffe6e6; }
.risk-critical { background: #ffcccc; }
.iso-tip {
    background: rgba(255,255,255,0.1);
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}
</style>
</head>
<body>
<header>
    <h1><i class="fa fa-network-wired"></i> Audit Flux Réseaux ISO 27001</h1>
    <div class="toolbar">
        <button class="btn btn-success" onclick="openAddFlowModal()"><i class="fa fa-plus"></i> Flux</button>
        <button class="btn btn-secondary" onclick="exportJSON()"><i class="fa fa-download"></i> JSON</button>
        <button class="btn btn-secondary" onclick="exportExcel()"><i class="fa fa-file-excel"></i> Excel</button>
        <button class="btn btn-success" onclick="generateAuditPDF()"><i class="fa fa-file-pdf"></i> PDF</button>
        <button class="btn btn-danger" onclick="clearAll()"><i class="fa fa-trash"></i> Effacer</button>
        <input type="search" id="searchInput" class="search-box" placeholder="🔍 Rechercher..." oninput="filterTable()">
        <button class="btn" onclick="toggleTheme()"><i class="fa fa-adjust"></i></button>
    </div>
</header>
<main>
    <h3>📋 Liste des flux</h3>
    <div class="iso-tip">
        📜 <strong>ISO 27001 A.13.1.1:</strong> Les contrôles réseau doivent être mis en œuvre pour protéger les informations.
    </div>
    <table id="flowTable">
        <thead>
            <tr>
                <th onclick="sortTable(0)">Nom</th>
                <th onclick="sortTable(1)">Protocole</th>
                <th onclick="sortTable(2)">Source</th>
                <th onclick="sortTable(3)">Destination</th>
                <th onclick="sortTable(4)">Risque</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="flowTableBody"></tbody>
    </table>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let flows = [];
let undoStack = [];
let redoStack = [];

function saveState() {
    undoStack.push(JSON.stringify(flows));
    localStorage.setItem('flowsData', JSON.stringify(flows));
}
function undo() {
    if (undoStack.length > 0) {
        redoStack.push(JSON.stringify(flows));
        flows = JSON.parse(undoStack.pop());
        render();
    }
}
function redo() {
    if (redoStack.length > 0) {
        undoStack.push(JSON.stringify(flows));
        flows = JSON.parse(redoStack.pop());
        render();
    }
}
function toggleTheme() {
    document.body.classList.toggle('dark');
}
function openAddFlowModal() {
    const name = prompt("Nom du flux:");
    const protocol = prompt("Protocole:");
    const source = prompt("IP Source:");
    const dest = prompt("IP Destination:");
    const risk = prompt("Risque (low, medium, high, critical):");
    if (name && protocol && source && dest && risk) {
        flows.push({ id: Date.now(), name, protocol, source, dest, risk });
        saveState();
        render();
    }
}
function exportJSON() {
    const blob = new Blob([JSON.stringify(flows,null,2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'flux.json';
    a.click();
}
function exportExcel() {
    const ws = XLSX.utils.json_to_sheet(flows);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Flux");
    XLSX.writeFile(wb, "flux.xlsx");
}
function generateAuditPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Audit Flux Réseaux ISO 27001", 20, 20);
    flows.forEach((f, i) => {
        doc.text(`${i+1}. ${f.name} - ${f.protocol} - ${f.source} -> ${f.dest} - ${f.risk}`, 20, 30 + i*10);
    });
    doc.save("audit-flux.pdf");
}
function clearAll() {
    if (confirm("Tout effacer ?")) {
        flows = [];
        saveState();
        render();
    }
}
function filterTable() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll("#flowTableBody tr");
    rows.forEach(row => {
        row.style.display = row.textContent.toLowerCase().includes(term) ? "" : "none";
    });
}
function sortTable(colIndex) {
    flows.sort((a,b) => {
        const valA = Object.values(a)[colIndex].toString().toLowerCase();
        const valB = Object.values(b)[colIndex].toString().toLowerCase();
        return valA.localeCompare(valB);
    });
    render();
}
function render() {
    const tbody = document.getElementById('flowTableBody');
    tbody.innerHTML = "";
    flows.forEach(flow => {
        const tr = document.createElement('tr');
        tr.classList.add(`risk-${flow.risk}`);
        tr.innerHTML = `
            <td>${flow.name}</td>
            <td>${flow.protocol}</td>
            <td>${flow.source}</td>
            <td>${flow.dest}</td>
            <td>${flow.risk}</td>
            <td>
                <button onclick="deleteFlow(${flow.id})" class="btn btn-danger btn-sm"><i class="fa fa-trash"></i></button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}
function deleteFlow(id) {
    flows = flows.filter(f => f.id !== id);
    saveState();
    render();
}
window.onload = () => {
    const saved = localStorage.getItem('flowsData');
    if (saved) flows = JSON.parse(saved);
    render();
};
</script>
</body>
</html>
