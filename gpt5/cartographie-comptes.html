<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cartographie Comptes Privil√©gi√©s - ISO 27001</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --secondary: #764ba2;
    --success: #48bb78;
    --danger: #f56565;
    --warning: #ed8936;
    --info: #4299e1;
    --dark: #2d3748;
    --light: #f7fafc;
    --gray: #718096;
    --border: #e2e8f0;
    --bg: #ffffff;
    --text: #2d3748;
}
body.dark {
    --bg: #1a202c;
    --text: #e2e8f0;
    --border: #4a5568;
}
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s, color 0.3s;
}
header {
    background: var(--primary);
    color: white;
    padding: 0.8rem 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}
header h1 {
    font-size: 1.1rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.toolbar {
    display: flex;
    gap: 0.4rem;
    flex-wrap: wrap;
}
.btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0.4rem 0.7rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.btn:hover { background: var(--primary-dark); }
.btn-secondary { background: var(--gray); }
.btn-danger { background: var(--danger); }
.btn-success { background: var(--success); }
.btn-warning { background: var(--warning); }
.search-box {
    padding: 0.3rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.8rem;
}
main {
    display: flex;
    height: calc(100vh - 60px);
}
.sidebar {
    width: 300px;
    border-right: 1px solid var(--border);
    padding: 1rem;
    overflow-y: auto;
    background: var(--light);
}
.canvas-container {
    flex: 1;
    background: var(--bg);
    overflow: auto;
    position: relative;
}
.stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
}
.stat-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    text-align: center;
}
.stat-card h3 {
    margin: 0;
    font-size: 1.1rem;
}
.iso-tip {
    background: rgba(255,255,255,0.1);
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}
.modal-content {
    background: var(--bg);
    margin: 2% auto;
    padding: 1rem;
    border-radius: 10px;
    width: 95%;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
}
.modal-content h2 {
    margin-top: 0;
    font-size: 1.1rem;
    color: var(--primary);
}
.input-group {
    margin-bottom: 0.8rem;
}
.input-group label {
    display: block;
    font-size: 0.85rem;
    margin-bottom: 0.2rem;
}
.input-group input, .input-group select, .input-group textarea {
    width: 100%;
    padding: 0.4rem;
    border: 1px solid var(--border);
    border-radius: 6px;
    font-size: 0.85rem;
}
</style>
</head>
<body>
<header>
    <h1><i class="fa fa-shield-alt"></i> Cartographie Comptes ISO 27001</h1>
    <div class="toolbar">
        <button class="btn btn-success" onclick="openAddServerModal()"><i class="fa fa-plus"></i> Serveur</button>
        <button class="btn btn-secondary" onclick="openManageListsModal()"><i class="fa fa-list"></i> Listes</button>
        <button class="btn btn-success" onclick="generateAuditPDF()"><i class="fa fa-file-pdf"></i> PDF Audit</button>
        <button class="btn btn-secondary" onclick="exportJSON()"><i class="fa fa-download"></i> JSON</button>
        <button class="btn btn-secondary" onclick="exportDrawio()"><i class="fa fa-project-diagram"></i> Draw.io</button>
        <button class="btn btn-secondary" onclick="exportSVG()"><i class="fa fa-image"></i> SVG</button>
        <button class="btn btn-warning" onclick="importJSON()"><i class="fa fa-upload"></i> Importer</button>
        <button class="btn btn-danger" onclick="clearAll()"><i class="fa fa-trash"></i> Effacer</button>
        <input type="search" id="searchInput" class="search-box" placeholder="üîç Rechercher..." oninput="filterData()">
        <button class="btn" onclick="toggleTheme()"><i class="fa fa-adjust"></i></button>
    </div>
</header>
<main>
    <div class="sidebar">
        <h3>üìä Statistiques</h3>
        <div class="stats">
            <div class="stat-card"><h3 id="serverCount">0</h3><p>Serveurs</p></div>
            <div class="stat-card"><h3 id="accountCount">0</h3><p>Comptes</p></div>
            <div class="stat-card"><h3 id="identityCount">0</h3><p>Identit√©s</p></div>
            <div class="stat-card"><h3 id="connectionCount">0</h3><p>Connexions</p></div>
        </div>
        <div class="iso-tip">
            üìú <strong>ISO 27001 A.9.2.3:</strong> Les droits d'acc√®s privil√©gi√©s doivent √™tre restreints et contr√¥l√©s.
        </div>
    </div>
    <div class="canvas-container" id="canvas">
        <svg id="svgCanvas"></svg>
    </div>
</main>

<!-- Modales (Serveur, Compte, Identit√©, Listes, PDF Audit) -->
<div class="modal" id="serverModal">
    <div class="modal-content">
        <h2>üñ•Ô∏è Ajouter un serveur</h2>
        <div class="input-group">
            <label>Nom du serveur :</label>
            <input type="text" id="serverName">
        </div>
        <div class="input-group">
            <label>Syst√®me d'exploitation :</label>
            <select id="serverOS"></select>
        </div>
        <div class="input-group">
            <label>Logiciel principal :</label>
            <select id="serverSoftware"></select>
        </div>
        <button class="btn btn-success" onclick="confirmAddServer()">Ajouter</button>
        <button class="btn btn-secondary" onclick="closeModal('serverModal')">Annuler</button>
    </div>
</div>

<script>
    // =========================
    // Donn√©es principales
    // =========================
    let data = {
        servers: [],
        settings: {
            osList: ["Windows Server 2022", "Ubuntu 22.04", "Debian 12"],
            softwareList: ["SQL Server", "Apache", "Nginx"],
            typeAccessList: ["Administration", "Lecture seule", "Application"],
            authMethodList: ["MFA", "Mot de passe", "Certificat", "SSO"],
            typeAccountList: ["Personnel", "Partag√©", "Service", "Application"],
            roleList: ["Admin syst√®me", "DBA", "Support", "DevOps"],
            justificationList: ["Projet X", "Maintenance", "Urgence"]
        }
    };

    // Historique pour undo/redo
    let undoStack = [];
    let redoStack = [];

    // =========================
    // Fonctions utilitaires
    // =========================
    function saveState() {
        undoStack.push(JSON.stringify(data));
        localStorage.setItem('cartoData', JSON.stringify(data));
    }
    function undo() {
        if (undoStack.length > 0) {
            redoStack.push(JSON.stringify(data));
            data = JSON.parse(undoStack.pop());
            render();
        }
    }
    function redo() {
        if (redoStack.length > 0) {
            undoStack.push(JSON.stringify(data));
            data = JSON.parse(redoStack.pop());
            render();
        }
    }
    function closeModal(id) {
        document.getElementById(id).style.display = 'none';
    }
    function openModal(id) {
        document.getElementById(id).style.display = 'block';
    }
    function populateSelect(id, items, selectedValue = "") {
        const sel = document.getElementById(id);
        sel.innerHTML = "";
        sel.innerHTML += '<option value="">-- Aucun --</option>';
        items.forEach(item => {
            const selected = selectedValue === item ? ' selected' : '';
            sel.innerHTML += `<option value="${item}"${selected}>${item}</option>`;
        });
    }

    // =========================
    // Gestion Serveurs
    // =========================
    let currentServerId = null;
    function openAddServerModal() {
        currentServerId = null;
        document.getElementById('serverName').value = "";
        populateSelect('serverOS', data.settings.osList);
        populateSelect('serverSoftware', data.settings.softwareList);
        openModal('serverModal');
    }
    function confirmAddServer() {
        const name = document.getElementById('serverName').value.trim();
        const os = document.getElementById('serverOS').value;
        const software = document.getElementById('serverSoftware').value;
        if (!name) return alert("Nom requis");

        if (currentServerId) {
            // Modification
            const server = data.servers.find(s => s.id === currentServerId);
            server.name = name;
            server.os = os;
            server.software = software;
        } else {
            // Ajout
            data.servers.push({
                id: Date.now(),
                name,
                os,
                software,
                accounts: []
            });
        }
        saveState();
        closeModal('serverModal');
        render();
    }
    function deleteServer(id) {
        if (confirm("Supprimer ce serveur ?")) {
            data.servers = data.servers.filter(s => s.id !== id);
            saveState();
            render();
        }
    }

    // =========================
    // Gestion Comptes
    // =========================
    let currentAccountId = null;
    function openAddAccountModal(serverId) {
        currentServerId = serverId;
        currentAccountId = null;
        // Pr√©parer modale compte (√† cr√©er dans HTML partie 1)
    }
    function confirmAddAccount() {
        // Logique ajout/modif compte
    }
    function deleteAccount(serverId, accountId) {
        const server = data.servers.find(s => s.id === serverId);
        server.accounts = server.accounts.filter(a => a.id !== accountId);
        saveState();
        render();
    }

    // =========================
    // Gestion Identit√©s
    // =========================
    let currentIdentityId = null;
    function openAddIdentityModal(serverId, accountId) {
        currentServerId = serverId;
        currentAccountId = accountId;
        currentIdentityId = null;
        // Pr√©parer modale identit√©
    }
    function confirmAddIdentity() {
        // Logique ajout/modif identit√©
    }
    function deleteIdentity(serverId, accountId, identityId) {
        const server = data.servers.find(s => s.id === serverId);
        const account = server.accounts.find(a => a.id === accountId);
        account.identities = account.identities.filter(i => i.id !== identityId);
        saveState();
        render();
    }

    // =========================
    // Gestion Listes
    // =========================
    function openManageListsModal() {
        // Pr√©parer modale listes
    }
    function saveLists() {
        // Sauvegarder modifications listes
        saveState();
        render();
    }

    // =========================
    // Recherche / Filtrage
    // =========================
    function filterData() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        // Filtrage appliqu√© au rendu graphique (Partie 3)
    }

    // =========================
    // Initialisation
    // =========================
    window.onload = () => {
        const saved = localStorage.getItem('cartoData');
        if (saved) data = JSON.parse(saved);
        render();
    };
</script>

<script>
// =========================
// Rendu graphique SVG
// =========================
const svg = document.getElementById('svgCanvas');
let currentPage = 1;
let serversPerPage = 6;
let maxTotalPages = 1;

// Fonction principale de rendu
function render() {
    svg.innerHTML = `
        <defs>
            <linearGradient id="serverGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#8e44ad;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="accountGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="identityGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#2ecc71;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#27ae60;stop-opacity:1" />
            </linearGradient>
        </defs>
    `;

    // Pagination
    const totalServers = data.servers.length;
    maxTotalPages = Math.max(1, Math.ceil(totalServers / serversPerPage));
    if (currentPage > maxTotalPages) currentPage = maxTotalPages;
    const startIndex = (currentPage - 1) * serversPerPage;
    const endIndex = Math.min(startIndex + serversPerPage, totalServers);
    const serversToRender = data.servers.slice(startIndex, endIndex);

    // Positionnement
    let serverX = 100;
    const serverY = 100;
    const spacingX = 300;
    const spacingY = 200;

    serversToRender.forEach(server => {
        drawNode(serverX, serverY, server.name, 'server', () => {
            showContextMenu('server', server.id, null, null, serverX, serverY);
        }, () => deleteServer(server.id));

        let accountX = serverX;
        let accountY = serverY + spacingY;
        server.accounts.forEach(account => {
            drawNode(accountX, accountY, account.name, 'account', () => {
                showContextMenu('account', server.id, account.id, null, accountX, accountY);
            }, () => deleteAccount(server.id, account.id));

            let identityX = accountX;
            let identityY = accountY + spacingY;
            account.identities?.forEach(identity => {
                drawNode(identityX, identityY, identity.name, 'identity', () => {
                    showContextMenu('identity', server.id, account.id, identity.id, identityX, identityY);
                }, () => deleteIdentity(server.id, account.id, identity.id));
                identityX += 200;
            });
            accountX += 250;
        });
        serverX += spacingX;
    });

    updateStats();
}

// Dessin d‚Äôun n≈ìud
function drawNode(x, y, text, type, onClick, onDelete) {
    const g = document.createElementNS("http://www.w3.org/2000/svg","g");
    g.style.cursor = 'pointer';

    const rect = document.createElementNS("http://www.w3.org/2000/svg","rect");
    rect.setAttribute("x", x - 60);
    rect.setAttribute("y", y - 20);
    rect.setAttribute("width", 120);
    rect.setAttribute("height", 40);
    rect.setAttribute("rx", 8);
    rect.setAttribute("class", type);
    rect.setAttribute("fill", `url(#${type}Gradient)`);
    rect.addEventListener('click', onClick);
    g.appendChild(rect);

    const label = document.createElementNS("http://www.w3.org/2000/svg","text");
    label.setAttribute("x", x);
    label.setAttribute("y", y + 5);
    label.setAttribute("text-anchor", "middle");
    label.setAttribute("fill", "white");
    label.setAttribute("font-size", "12");
    label.textContent = text;
    g.appendChild(label);

    const del = document.createElementNS("http://www.w3.org/2000/svg","text");
    del.setAttribute("x", x + 50);
    del.setAttribute("y", y - 10);
    del.setAttribute("fill", "#ff4757");
    del.setAttribute("font-size", "14");
    del.setAttribute("cursor", "pointer");
    del.textContent = "√ó";
    del.addEventListener('click', e => { e.stopPropagation(); onDelete(); });
    g.appendChild(del);

    svg.appendChild(g);
}

// =========================
// Menus contextuels
// =========================
function showContextMenu(type, serverId, accountId, identityId, x, y) {
    const existingMenu = document.getElementById('contextMenu');
    if (existingMenu) existingMenu.remove();

    const menu = document.createElement('div');
    menu.id = 'contextMenu';
    menu.style.cssText = `
        position: absolute;
        left: ${x}px;
        top: ${y}px;
        background: white;
        border: 1px solid var(--border);
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 3000;
    `;

    const options = [];
    if (type === 'server') {
        options.push({ text: '‚ûï Ajouter un compte', action: () => openAddAccountModal(serverId) });
    } else if (type === 'account') {
        options.push({ text: '‚ûï Ajouter une identit√©', action: () => openAddIdentityModal(serverId, accountId) });
    }

    options.forEach(opt => {
        const btn = document.createElement('button');
        btn.textContent = opt.text;
        btn.style.cssText = `
            display: block;
            width: 100%;
            padding: 8px;
            border: none;
            background: white;
            cursor: pointer;
            text-align: left;
        `;
        btn.addEventListener('click', () => {
            opt.action();
            menu.remove();
        });
        menu.appendChild(btn);
    });

    document.body.appendChild(menu);
    document.addEventListener('click', e => {
        if (!menu.contains(e.target)) menu.remove();
    }, { once: true });
}

// =========================
// Zoom / Pan
// =========================
let panX = 0, panY = 0, scale = 1, isPanning = false, startX, startY;
const container = document.getElementById('canvas');

container.addEventListener('mousedown', e => {
    if (e.target === container || e.target === svg) {
        isPanning = true;
        startX = e.clientX - panX;
        startY = e.clientY - panY;
        container.style.cursor = 'grabbing';
    }
});
container.addEventListener('mouseup', () => {
    isPanning = false;
    container.style.cursor = 'default';
});
container.addEventListener('mousemove', e => {
    if (!isPanning) return;
    panX = e.clientX - startX;
    panY = e.clientY - startY;
    svg.style.transform = `translate(${panX}px,${panY}px) scale(${scale})`;
});
container.addEventListener('wheel', e => {
    if (!e.ctrlKey) return;
    e.preventDefault();
    const oldScale = scale;
    scale *= e.deltaY > 0 ? 0.9 : 1.1;
    scale = Math.max(0.1, Math.min(3, scale));
    const scaleFactor = scale / oldScale;
    panX *= scaleFactor;
    panY *= scaleFactor;
    svg.style.transform = `translate(${panX}px,${panY}px) scale(${scale})`;
}, { passive: false });

// =========================
// Pagination
// =========================
function changePage(dir) {
    const newPage = currentPage + dir;
    if (newPage >= 1 && newPage <= maxTotalPages) {
        currentPage = newPage;
        render();
    }
}

// =========================
// Stats
// =========================
function updateStats() {
    const serverCount = data.servers.length;
    const accountCount = data.servers.reduce((t, s) => t + s.accounts.length, 0);
    const identityCount = data.servers.reduce((t, s) => t + s.accounts.reduce((a, acc) => a + (acc.identities?.length || 0), 0), 0);
    const connectionCount = accountCount + identityCount;
    document.getElementById('serverCount').textContent = serverCount;
    document.getElementById('accountCount').textContent = accountCount;
    document.getElementById('identityCount').textContent = identityCount;
    document.getElementById('connectionCount').textContent = connectionCount;
}
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// =========================
// Export JSON
// =========================
function exportJSON() {
    const blob = new Blob([JSON.stringify(data,null,2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `cartographie-iso27001-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
}

// =========================
// Import JSON
// =========================
function importJSON() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
            try {
                data = JSON.parse(ev.target.result);
                saveState();
                render();
                alert('Import r√©ussi');
            } catch (err) {
                alert('Erreur import: ' + err.message);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// =========================
// Export Draw.io
// =========================
function exportDrawio() {
    let xml = '<?xml version="1.0" encoding="UTF-8"?><mxfile><diagram name="Cartographie"><mxGraphModel><root>';
    xml += '<mxCell id="0"/><mxCell id="1" parent="0"/>';
    let cellId = 2;
    data.servers.forEach((s, si) => {
        xml += `<mxCell id="${cellId}" value="${s.name}" style="shape=ellipse;fillColor=#8e44ad;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="${si*200}" y="0" width="160" height="60" as="geometry"/></mxCell>`;
        cellId++;
        s.accounts.forEach((a, ai) => {
            xml += `<mxCell id="${cellId}" value="${a.name}" style="shape=ellipse;fillColor=#2980b9;fontColor=#FFFFFF;" vertex="1" parent="1"><mxGeometry x="${si*200}" y="${(ai+1)*100}" width="160" height="60" as="geometry"/></mxCell>`;
            cellId++;
        });
    });
    xml += '</root></mxGraphModel></diagram></mxfile>';
    const blob = new Blob([xml], { type: 'application/xml' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `cartographie-${new Date().toISOString().split('T')[0]}.drawio`;
    a.click();
}

// =========================
// Export SVG
// =========================
function exportSVG() {
    const svgElement = document.getElementById('svgCanvas').cloneNode(true);
    svgElement.setAttribute('xmlns', 'http://www.w3.org/2000/svg');
    const serializer = new XMLSerializer();
    const source = serializer.serializeToString(svgElement);
    const blob = new Blob([source], { type: 'image/svg+xml;charset=utf-8' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `cartographie-${new Date().toISOString().split('T')[0]}.svg`;
    a.click();
}

// =========================
// G√©n√©ration PDF Audit ISO 27001
// =========================
async function generateAuditPDF() {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF('l', 'mm', 'a4');
    let y = 20;

    pdf.setFontSize(18);
    pdf.text("Audit Comptes Privil√©gi√©s - ISO 27001", 20, y);
    y += 10;

    // Statistiques
    pdf.setFontSize(12);
    pdf.text(`Serveurs: ${data.servers.length}`, 20, y); y += 6;
    const accountCount = data.servers.reduce((t, s) => t + s.accounts.length, 0);
    pdf.text(`Comptes: ${accountCount}`, 20, y); y += 6;
    const identityCount = data.servers.reduce((t, s) => t + s.accounts.reduce((a, acc) => a + (acc.identities?.length || 0), 0), 0);
    pdf.text(`Identit√©s: ${identityCount}`, 20, y); y += 10;

    // Inventaire
    data.servers.forEach((server, si) => {
        pdf.setFontSize(14);
        pdf.text(`${si+1}. Serveur: ${server.name}`, 20, y); y += 6;
        pdf.setFontSize(10);
        if (server.os) { pdf.text(`OS: ${server.os}`, 25, y); y += 4; }
        if (server.software) { pdf.text(`Logiciel: ${server.software}`, 25, y); y += 4; }
        server.accounts.forEach((account, ai) => {
            pdf.text(`Compte: ${account.name}`, 30, y); y += 4;
            account.identities?.forEach(identity => {
                pdf.text(`- Identit√©: ${identity.name}`, 35, y); y += 4;
            });
        });
        y += 4;
        if (y > 180) { pdf.addPage(); y = 20; }
    });

    // Capture visuelle
    const canvas = await html2canvas(document.getElementById('canvas'));
    const imgData = canvas.toDataURL('image/png');
    pdf.addPage();
    pdf.addImage(imgData, 'PNG', 10, 20, 270, 150);

    pdf.save(`audit-comptes-${new Date().toISOString().split('T')[0]}.pdf`);
}

// =========================
// Alertes ISO 27001
// =========================
function checkISOAlerts() {
    let alerts = [];
    data.servers.forEach(server => {
        server.accounts.forEach(account => {
            account.identities?.forEach(identity => {
                if (!identity.lastReview || new Date(identity.lastReview) < new Date(Date.now() - 365*24*60*60*1000)) {
                    alerts.push(`Identit√© "${identity.name}" sur compte "${account.name}" est en retard de revue`);
                }
            });
        });
    });
    if (alerts.length > 0) {
        console.warn("Alertes ISO 27001:", alerts);
        alert("‚ö†Ô∏è Alertes ISO 27001:\n" + alerts.join("\n"));
    }
}

// =========================
// Initialisation
// =========================
window.addEventListener('load', () => {
    const saved = localStorage.getItem('cartoData');
    if (saved) data = JSON.parse(saved);
    render();
    checkISOAlerts();
});
</script>
</body>
</html>
