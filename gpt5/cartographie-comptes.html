<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Cartographie Comptes Privil√©gi√©s - ISO 27001</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
:root {
    --primary: #667eea;
    --primary-dark: #5a67d8;
    --secondary: #764ba2;
    --success: #48bb78;
    --danger: #f56565;
    --warning: #ed8936;
    --info: #4299e1;
    --dark: #2d3748;
    --light: #f7fafc;
    --gray: #718096;
    --border: #e2e8f0;
    --bg: #ffffff;
    --text: #2d3748;
}
body.dark {
    --bg: #1a202c;
    --text: #e2e8f0;
    --border: #4a5568;
}
body {
    margin: 0;
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    transition: background 0.3s, color 0.3s;
}
header {
    background: var(--primary);
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: sticky;
    top: 0;
    z-index: 100;
}
header h1 {
    font-size: 1.2rem;
    margin: 0;
}
.toolbar {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}
.btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0.5rem 0.8rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 0.3rem;
}
.btn:hover {
    background: var(--primary-dark);
}
.btn-secondary { background: var(--gray); }
.btn-danger { background: var(--danger); }
.btn-success { background: var(--success); }
.search-box {
    padding: 0.4rem;
    border: 1px solid var(--border);
    border-radius: 6px;
}
main {
    display: flex;
    height: calc(100vh - 60px);
}
.sidebar {
    width: 300px;
    border-right: 1px solid var(--border);
    padding: 1rem;
    overflow-y: auto;
}
.canvas-container {
    flex: 1;
    background: var(--light);
    overflow: auto;
    position: relative;
}
.stats {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.5rem;
}
.stat-card {
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0.5rem;
    text-align: center;
}
.stat-card h3 {
    margin: 0;
    font-size: 1.2rem;
}
.iso-tip {
    background: rgba(255,255,255,0.1);
    padding: 0.5rem;
    border-radius: 6px;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}
</style>
</head>
<body>
<header>
    <h1>üõ°Ô∏è Cartographie Comptes ISO 27001</h1>
    <div class="toolbar">
        <button class="btn btn-success" onclick="openAddServerModal()"><i class="fa fa-plus"></i> Serveur</button>
        <button class="btn btn-secondary" onclick="exportJSON()"><i class="fa fa-download"></i> JSON</button>
        <button class="btn btn-secondary" onclick="exportExcel()"><i class="fa fa-file-excel"></i> Excel</button>
        <button class="btn btn-success" onclick="generateAuditPDF()"><i class="fa fa-file-pdf"></i> PDF</button>
        <button class="btn btn-danger" onclick="clearAll()"><i class="fa fa-trash"></i> Effacer</button>
        <input type="search" id="searchInput" class="search-box" placeholder="üîç Rechercher..." oninput="filterData()">
        <button class="btn" onclick="toggleTheme()"><i class="fa fa-adjust"></i></button>
    </div>
</header>
<main>
    <div class="sidebar">
        <h3>üìä Statistiques</h3>
        <div class="stats">
            <div class="stat-card"><h3 id="serverCount">0</h3><p>Serveurs</p></div>
            <div class="stat-card"><h3 id="accountCount">0</h3><p>Comptes</p></div>
            <div class="stat-card"><h3 id="identityCount">0</h3><p>Identit√©s</p></div>
            <div class="stat-card"><h3 id="riskScore">0</h3><p>Score Risque</p></div>
        </div>
        <div class="iso-tip">
            üìú <strong>ISO 27001 A.9.2.3:</strong> Les droits d'acc√®s privil√©gi√©s doivent √™tre restreints et contr√¥l√©s.
        </div>
    </div>
    <div class="canvas-container" id="canvas">
        <!-- SVG or diagram rendering here -->
    </div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let data = { servers: [] };
let undoStack = [];
let redoStack = [];

function saveState() {
    undoStack.push(JSON.stringify(data));
    localStorage.setItem('cartoData', JSON.stringify(data));
}
function undo() {
    if (undoStack.length > 0) {
        redoStack.push(JSON.stringify(data));
        data = JSON.parse(undoStack.pop());
        render();
    }
}
function redo() {
    if (redoStack.length > 0) {
        undoStack.push(JSON.stringify(data));
        data = JSON.parse(redoStack.pop());
        render();
    }
}
function toggleTheme() {
    document.body.classList.toggle('dark');
}
function openAddServerModal() {
    const name = prompt("Nom du serveur:");
    if (name) {
        data.servers.push({ id: Date.now(), name, accounts: [] });
        saveState();
        render();
    }
}
function exportJSON() {
    const blob = new Blob([JSON.stringify(data,null,2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'cartographie.json';
    a.click();
}
function exportExcel() {
    const ws = XLSX.utils.json_to_sheet(data.servers);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Serveurs");
    XLSX.writeFile(wb, "cartographie.xlsx");
}
function generateAuditPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text("Audit Comptes Privil√©gi√©s ISO 27001", 10, 10);
    doc.save("audit-comptes.pdf");
}
function clearAll() {
    if (confirm("Tout effacer ?")) {
        data.servers = [];
        saveState();
        render();
    }
}
function filterData() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    // Filtering logic here
}
function render() {
    document.getElementById('serverCount').textContent = data.servers.length;
    let accounts = 0, identities = 0, risk = 0;
    data.servers.forEach(s => {
        accounts += s.accounts.length;
        s.accounts.forEach(a => {
            identities += a.identities?.length || 0;
            risk += (a.identities?.length || 0) > 5 ? 2 : 1;
        });
    });
    document.getElementById('accountCount').textContent = accounts;
    document.getElementById('identityCount').textContent = identities;
    document.getElementById('riskScore').textContent = risk;
}
window.onload = () => {
    const saved = localStorage.getItem('cartoData');
    if (saved) data = JSON.parse(saved);
    render();
};
</script>
</body>
</html>
